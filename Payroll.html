<!DOCTYPE HTML>
<html>
	<head>
		<title>Simple Payroll Calculator</title>
        
        <link rel="stylesheet" href="html5up-dimension/assets/css/main.css">
        
                <style>
            /* New article ID: 'payroll-calc' */
            #payroll-calc .field {
                margin-bottom: 1rem;
            }
            /* Styling for the Payroll Data Input section */
            #payroll-calc .input-group {
                background: rgba(255, 255, 255, 0.035);
                padding: 1.5em;
                margin-bottom: 2rem;
                border-radius: 4px;
            }
            /* Align the buttons in the actions group */
            #payroll-calc .actions {
                justify-content: flex-start;
                margin-top: 1.5rem;
            }
            /* Styling the dynamic table for the Dimension theme */
            #payroll-calc table {
                width: 100%;
                margin-top: 2rem;
                color: #ffffff;
                border-collapse: collapse;
            }
            #payroll-calc table thead th {
                color: #ffffff;
                font-weight: 600;
                border-bottom: solid 1px rgba(255, 255, 255, 0.2);
            }
            #payroll-calc table th, #payroll-calc table td {
                padding: 0.75em 0.5em;
                text-align: center;
            }
            /* Ensure the dialog box is visible and styled */
            dialog {
                background: #1b1f22;
                color: #ffffff;
                border: solid 1px #808080;
                border-radius: 4px;
                padding: 2em;
            }
            dialog h4 {
                color: #ffffff;
                margin-top: 0;
            }
            /* Style buttons inside dialogs using theme styles */
            dialog button {
                padding: 0.5em 1.5em;
                border-radius: 4px;
                background: #666;
                color: #fff;
                margin: 0 0.5em;
                cursor: pointer;
            }
            dialog button#confirmm {
                background: #8e104b; /* Primary color hint */
            }
        </style>
	</head>
	<body class="is-preload" onload="initpayroll()">

		<div id="wrapper">

			<header id="header">
				<div class="logo">
					<span class="icon fa-file-invoice-dollar"></span>
				</div>
				<div class="content">
					<div class="inner">
						<h1>Payroll System</h1>
						<p>Simple Employee Data and Net Pay Calculation</p>
					</div>
				</div>
				<nav>
					<ul>
						<li><a href="#payroll-calc">START</a></li>
					</ul>
				</nav>
			</header>

			<div id="main">

				<article id="payroll-calc" class="active"> 
					<h2 class="major">Employee Payroll Manager</h2>
					
                    <div class="input-group">
                        <div class="field">
                            <label for="empName">Employee Name:</label>
                            <input id="empName" name="empName" type="text" placeholder="Full Name">
                        </div>
                        <div class="field">
                            <label for="daysWorked">Days Worked:</label>
                            <input id="daysWorked" name="daysWorked" type="number" placeholder="e.g., 20">
                        </div>
                        <div class="field">
                            <label for="dailyRate">Daily Rate:</label>
                            <input id="dailyRate" name="dailyRate" type="number" placeholder="e.g., 500.00">
                        </div>
                        <div class="field">
                            <label for="deductionAmount">Deduction Amount:</label>
                            <input id="deductionAmount" name="deductionAmount" type="number" placeholder="e.g., 100.00">
                        </div>
                        
                        <ul class="actions">
                            <li><button id="addEmp" class="button primary">ADD EMPLOYEE</button></li>
                        </ul>
                    </div>

                    <hr>

                    <h3>Employee List:</h3>
                    <p id="emp"></p>

                    <div class="box">
                        <ul class="actions">
                            <li><button id="clear" class="button">CLEAR LIST</button></li>
                        </ul>
                        
                        <div class="field" style="max-width: 15rem; margin-bottom: 0;">
                            <label for="delEmp">Remove Employee No. :</label>
                            <input id="delEmp" name="delEmp" type="number" placeholder="Enter #">
                        </div>
                        
                        <ul class="actions">
                            <li><button id="deleteEmp" class="button alt">REMOVE</button></li>
                        </ul>
                    </div>

                    <a href="index.html" class="home-link">HOME</a>
				</article>

			</div>

			<footer id="footer">
				<p class="copyright">&copy; Untitled. Design: <a href="https://html5up.net">HTML5 UP</a>.</p>
			</footer>

		</div>

        <dialog id="dlgConfirmCancel">
            <form method="dialog">
            <h4 id="dlgmsg"> Clear Employee List? </h4>   
            <button id="confirmm" value="confirm" > CONFIRM </button>
            <button id="cancel" value="cancel" > CANCEL </button>
            </form>
        </dialog>

        <dialog id="dlgAreYouSure">
            <form method="dialog">
            <h4 id="dlgmsg2"> Are you sure? </h4>   
            <button id="yes" value="yes" > YES </button>
            <button id="no" value="no" > NO </button>
            </form>
        </dialog>

        <script src="html5up-dimension/assets/js/jquery.min.js"></script>
		<script src="html5up-dimension/assets/js/browser.min.js"></script>
		<script src="html5up-dimension/assets/js/breakpoints.min.js"></script>
		<script src="html5up-dimension/assets/js/util.js"></script>
		<script src="html5up-dimension/assets/js/main.js"></script>

		<script>
            // --- FIX APPLIED HERE: Using e.preventDefault() to ensure dialogs don't prematurely close/exit ---

            let emp = [];

            function initpayroll()
            {
                emp = [];
                document.getElementById("empName").value = "";
                document.getElementById("daysWorked").value = "";
                document.getElementById("dailyRate").value = "";
                document.getElementById("deductionAmount").value = "";
                document.getElementById("emp").innerHTML="";

                // Dialog setup
                const cancel = document.getElementById("cancel");
                const confirmm = document.getElementById("confirmm");
                const dlgConfirmCancel = document.getElementById("dlgConfirmCancel");
                dlgConfirmCancel.returnValue = "confirm";

                const yes = document.getElementById("yes");
                const no = document.getElementById("no");
                const dlgAreYouSure = document.getElementById("dlgAreYouSure");
                dlgAreYouSure.returnValue = "no";

                showList();
            }

            document.getElementById("addEmp").addEventListener("click",()=> 
            {
                let empName = document.getElementById("empName").value;
                let daysWorked = parseFloat(document.getElementById("daysWorked").value);
                let dailyRate = parseFloat(document.getElementById("dailyRate").value);
                let deductionAmount = parseFloat(document.getElementById("deductionAmount").value);

                // Basic validation before adding
                if (!empName || isNaN(daysWorked) || isNaN(dailyRate) || isNaN(deductionAmount)) {
                    alert("Please fill in all fields with valid data.");
                    return;
                }

                let empNo = {
                    empName: empName,
                    daysWorked: daysWorked,
                    dailyRate: dailyRate,
                    deductionAmount: deductionAmount,
                    // Calculation functions
                    cGross: function() { return Math.round(this.daysWorked * this.dailyRate); },
                    netPay: function() { return Math.round(this.cGross() - this.deductionAmount); }
                };

                emp.push(empNo);

                document.getElementById("empName").value = "";
                document.getElementById("daysWorked").value = "";
                document.getElementById("dailyRate").value = "";
                document.getElementById("deductionAmount").value = "";

            showList();

            });

            document.getElementById("clear").addEventListener("click", ()=>
            {
                document.getElementById("dlgmsg").innerHTML = "Delete all employees from the list?";
                dlgConfirmCancel.showModal();
                // Set action flag
                dlgConfirmCancel.dataset.action = "clearing";
            });

            document.getElementById("deleteEmp").addEventListener("click",()=>
            {
                let empNo = document.getElementById("delEmp").value*1;

                if (!empNo || empNo < 1 || empNo > emp.length)
                {
                    alert("Invalid Employee Number");
                    document.getElementById("delEmp").value = "";
                    return;
                }

                dlgAreYouSure.dataset.action = "deleting";
                dlgAreYouSure.dataset.empNo = empNo;
                document.getElementById("dlgmsg2").innerHTML = "Are you sure you want to remove employee #" + empNo + "?";
                dlgAreYouSure.showModal();
            });

            // --- FIXED DIALOG BUTTONS ---
            confirmm.addEventListener("click", (e) =>
            {
                e.preventDefault(); // Prevents immediate form submission/exit
                dlgConfirmCancel.returnValue = "confirm";
                dlgConfirmCancel.close();
            });

            cancel.addEventListener("click", (e) =>
            {
                e.preventDefault(); // Prevents immediate form submission/exit
                dlgConfirmCancel.returnValue = "cancel";
                dlgConfirmCancel.close();
            });

            yes.addEventListener("click", (e) =>
            {
                e.preventDefault(); // Prevents immediate form submission/exit
                dlgAreYouSure.returnValue = "yes";
                dlgAreYouSure.close();
            });

            no.addEventListener("click", (e) =>
            {
                e.preventDefault(); // Prevents immediate form submission/exit
                dlgAreYouSure.returnValue = "no";
                dlgAreYouSure.close();
            });
            // --- END FIXED DIALOG BUTTONS ---


            // This handles the transition from the first dialog to the second for CLEAR
            dlgConfirmCancel.addEventListener("close", (e)=>
            {
                let choice1 = e.target.returnValue;

                if (choice1 === "confirm" && dlgConfirmCancel.dataset.action === "clearing")
                {
                    dlgAreYouSure.dataset.action = "clearing"; // Set action on second dialog
                    document.getElementById("dlgmsg2").innerHTML = "Are you absolutely sure you want to clear the entire list?";
                    dlgAreYouSure.showModal();
                }
                // If choice is 'cancel', nothing happens, and the list remains.
            });


            // This handles the final action for both DELETE and CLEAR
            dlgAreYouSure.addEventListener("close", (e)=>
            {
                let choice = e.target.returnValue;

                if (choice === "yes")
                {
                    if (dlgAreYouSure.dataset.action === "deleting")
                    {
                        let x = parseInt(dlgAreYouSure.dataset.empNo, 10) - 1;
                        if (x >= 0 && x < emp.length)
                        {
                            emp.splice(x, 1);
                        }

                        document.getElementById("delEmp").value = '';
                        delete dlgAreYouSure.dataset.empNo;
                    }
                    else if (dlgAreYouSure.dataset.action === "clearing")
                    {
                        emp = [];
                    }

                showList();
                }
                
                // Reset action state after completion
                delete dlgConfirmCancel.dataset.action;
                delete dlgAreYouSure.dataset.action;

            });

            function showList()
            {
                let i, l, totalGross, totalDeduct, totalNet;
                let theader, tbody, tfooter;

                if (emp.length === 0) {
                    document.getElementById("emp").innerHTML = "<p style='text-align: center; color: #888;'>No employees added yet.</p>";
                    return;
                }

                theader = "<thead>";
                theader += "<tr>";
                theader += "<th>#</th>";
                theader += '<th style="text-align:left" >Employee Name</th>';
                theader += "<th>Days</th>";
                theader += '<th style="text-align:right">Rate</th>';
                theader += "<th>Gross</th>";
                theader += '<th style="text-align:right">Deduct.</th>';
                theader += "<th>Net Pay</th>";
                theader += "</tr>";
                theader += "</thead>";

                l = emp.length;

                for (i = 0, totalGross = 0, totalDeduct = 0, totalNet= 0, tbody = ''; i < l; i++)
                {
                    let ln = i + 1;
                    tbody += "<tr>"
                        +'<td style="text-align:center">' + ln + ' </td>'
                        +'<td style="text-align:left">' + emp[i].empName +' </td>'
                        +'<td style="text-align:right">'+emp[i].daysWorked +'</td>'
                        +'<td style="text-align:right">'+emp[i].dailyRate.toFixed(2) +'</td>'
                        +'<td style="text-align:right">'+emp[i].cGross().toFixed(2) + '</td>'
                        +'<td style="text-align:right">'+emp[i].deductionAmount.toFixed(2) +'</td>'
                        +'<td style="text-align:right">'+emp[i].netPay().toFixed(2) +'</td>'
                        +"</tr>";

                        totalGross += emp[i].cGross();
                        totalDeduct += emp[i].deductionAmount;
                        totalNet += emp[i].netPay();
                }

                tfooter ="<tfoot>";
                tfooter+="<tr>";
                tfooter+='<th colspan="2" style="text-align:left">Total Employees: '+emp.length+'</th>';
                tfooter+='<th></th>'; // Empty cell for Day Worked
                tfooter+='<th></th>'; // Empty cell for Daily Rate
                tfooter+='<th style="text-align:right">'+totalGross.toFixed(2)+'</th>';
                tfooter+='<th style="text-align:right">'+totalDeduct.toFixed(2)+'</th>';
                tfooter+='<th style="text-align:right">'+totalNet.toFixed(2)+'</th>';
                tfooter+="</tr>";
                tfooter+="</tfoot>";

                document.getElementById("emp").innerHTML
                ="<div class='table-wrapper'><table>" + theader + '<tbody>' + tbody + '</tbody>' + tfooter + "</table></div>";
            }
		</script>
	</body>
</html>
